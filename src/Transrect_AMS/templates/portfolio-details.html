<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Portfolio Details - Knight Bootstrap Template</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link rel="icon" href="{{ url_for('static', filename='assets/img/favicon.png') }}">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='assets/img/apple-touch-icon.png') }}">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link rel="stylesheet" type="text/css"
    href="{{ url_for('static', filename='assets/vendor/bootstrap/css/bootstrap.min.css') }}">
  <link rel="stylesheet" type="text/css"
    href="{{ url_for('static', filename='assets/vendor/bootstrap-icons/bootstrap-icons.css') }}">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/vendor/aos/aos.css') }}">
  <link rel="stylesheet" type="text/css"
    href="{{ url_for('static', filename='assets/vendor/swiper/swiper-bundle.min.css') }}">
  <link rel="stylesheet" type="text/css"
    href="{{ url_for('static', filename='assets/vendor/glightbox/css/glightbox.min.css') }}">

  <!-- Main CSS File -->
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/main.css') }}">
  <style>
    /* Cart Sidebar Styling */
    .cart-sidebar {
      position: fixed;
      top: 0;
      right: -350px;
      width: 350px;
      height: 100vh;
      background: #fff;
      box-shadow: -3px 0 10px rgba(0, 0, 0, 0.2);
      transition: right 0.3s ease-in-out;
      z-index: 1001;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    .cart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
    }

    .cart-items {
      flex-grow: 1;
      overflow-y: auto;
      margin-top: 10px;
    }

    .cart-footer {
      padding: 10px 0;
    }

    .cart-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #ddd;
    }

    .cart-item img {
      width: 50px;
      height: 50px;
      margin-right: 10px;
    }

    .cart-item-info {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .qty-btn {
      background: #ddd;
      border: none;
      padding: 5px;
      cursor: pointer;
    }

    .qty {
      font-weight: bold;
    }

    .remove-btn {
      background: none;
      border: none;
      font-size: 18px;
      cursor: pointer;
      color: red;
    }

    .cart-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 1000;
    }
  </style>
  <!-- =======================================================
  * Template Name: Knight
  * Template URL: https://bootstrapmade.com/knight-free-bootstrap-theme/
  * Updated: Oct 16 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body class="portfolio-details-page">

  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container-fluid position-relative d-flex align-items-center justify-content-between">

      <a href="/home" class="logo d-flex align-items-center me-auto me-xl-0">
        <!-- Uncomment the line below if you also wish to use an image logo -->
        <!-- <img src="assets/img/logo.png" alt=""> -->
        <h1 class="sitename">Transrect</h1>
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="/home">Home</a></li>
          <li><a href="/home#about">About</a></li>
          <li><a href="/home#services">Services</a></li>
          <li><a href="/home#portfolio">Portfolio</a></li>
          <li class="dropdown"><a href="/home#portfolio"><span>Machine</span> <i
                class="bi bi-chevron-down toggle-dropdown"></i></a>
            <ul>
              <li><a href="{{ url_for('log.mech_machine', id=1) }}">Co2 mig 150 TR</a></li>
              <li class="dropdown"><a href="#"><span>Machines</span> <i
                    class="bi bi-chevron-down toggle-dropdown"></i></a>
                <ul>
                  <li><a href="/home#portfolio">Machines</a></li>
                  <li><a href="/home#portfolio">Machines</a></li>
                  <li><a href="/home#portfolio">Machines</a></li>
                  <li><a href="/home#portfolio">Machines</a></li>
                  <li><a href="/home#portfolio">Machines</a></li>
                </ul>
              </li>
              <li><a href="{{ url_for('log.mech_machine', id=2) }}">Co2 mig 250 TR</a></li>
              <li><a href="{{ url_for('log.mech_machine', id=3) }}">Co2 mig portable TR</a></li>
              <li><a href="/home#portfolio">Machines</a></li>
            </ul>
          </li>
          <li><a href="/home#contact">Contact</a></li>
          <li><a href="{{ url_for('log.msg_userinbox') }}">Inbox</a></li>
          <li><a href="{{ url_for('log.msg_userinbox') }}">My Machines</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>

      <div class="header-social-links">
        <a href="{{ url_for('log.account_logout') }}" class="btn-get-started">Logout</a>
      </div>

    </div>
  </header>

  {% block content %}

  <main class="main">

    <!-- Page Title -->
    <div class="page-title dark-background">
      <div class="container">
        <h1>Portfolio Details</h1>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="/home">Home</a></li>
            <li class="current">Portfolio Details</li>
          </ol>
        </nav>
      </div>
    </div><!-- End Page Title -->

    <!-- Portfolio Details Section -->
    <section id="portfolio-details" class="portfolio-details section">

      <div class="container" data-aos="fade-up" data-aos-delay="100">

        <div class="row gy-4">

          <div class="col-lg-8">
            <div class="portfolio-details-slider swiper init-swiper">

              <script type="application/json" class="swiper-config">
                {
                  "loop": true,
                  "speed": 600,
                  "autoplay": {
                    "delay": 5000
                  },
                  "slidesPerView": "auto",
                  "pagination": {
                    "el": ".swiper-pagination",
                    "type": "bullets",
                    "clickable": true
                  }
                }
              </script>

              <!-- <div class="swiper-wrapper align-items-center">
                {% for img in desc.image %}
                <div style="height: 600px;" class="swiper-slide">
                  <img src="{{ url_for('static', filename=img) }}" alt="">
                </div>
                {% endfor %}
              </div> -->
              <div class="swiper-wrapper align-items-center">
                {% for img in desc.image %}
                <div style="height: 600px;" class="swiper-slide">
                  <img src="{{ url_for('static', filename=img) }}" alt=""
                    style="width: 100%; height: 100%; object-fit: contain; display: block; margin: auto;">
                </div>
                {% endfor %}
              </div>

              <div class="swiper-pagination"></div>
            </div>
          </div>

          <div class="col-lg-4">
            <div class="portfolio-info" data-aos="fade-up" data-aos-delay="200">
              <h3>Project information</h3>
              <ul>
                <li><strong>Name</strong>: {{ desc.name }}</li>
                <li><strong>Category</strong>: {{ desc.category }}</li>
                <li><strong>Model</strong>: {{ desc.model }}</li>
                <li><strong>Price</strong>: {{ desc.price }}</li>
                <li><strong>manufacturer</strong>: {{ desc.manufacturer }}</li>
              </ul>
            </div>
            <div class="portfolio-description" data-aos="fade-up" data-aos-delay="300">
              <h2>{{ desc.name }}</h2>
              <p>
                {{ desc.description }}
              </p> <br>


              <button class="btn btn-outline-secondary btn-lg fw-bold"
                onclick="addToCart('{{ desc.id }}', '{{ desc.name }}', '{{ url_for('static', filename=desc.image[0]) }}', '{{ desc.price }}')">
                Add to Cart
              </button>

              <button class="btn btn-outline-secondary btn-lg fw-bold" onclick="openCart()">
                openCart
              </button>



              <button class="btn btn-outline-success btn-lg fw-bold"
                onclick="window.location.href='{{ url_for('log.money_payment', machine_id=desc.id, machine_name=desc.name, machine_price=desc.price,machine_names=desc.name, machine_quantities=1) }}'">
                Buy Now
              </button>



            </div>

          </div>
        </div>

      </div>

      </div>

    </section><!-- /Portfolio Details Section -->

  </main>

  {% endblock %}

  <footer id="footer" class="footer dark-background">


    <div class="container footer-top">
      <div class="row gy-4">
        <div class="col-lg-4 col-md-6 footer-about">
          <a href="/home" class="d-flex align-items-center">
            <span class="sitename">Transrect Sales & Services</span>
          </a>
          <div class="footer-contact pt-3">
            <p>Address</p>
            <p>388/44, St Dnyaneshwar Rd, Laxmi-Narayan Nagar, Mauli Nagar, Charholi Budruk, Pimpri-Chinchwad,
              Maharashtra 412105, India</p>
            <p class="mt-3"><strong>Phone:</strong> <span>9511703739/8806619265</span></p>
            <br>
            <p><strong>Email:</strong> <span>transrectsalesandservices@gmail.com</span></p>
          </div>
        </div>

        <div class="col-lg-2 col-md-3 footer-links">
          <h4>Useful Links</h4>
          <ul>
            <li><i class="bi bi-chevron-right"></i> <a href="#">Home</a></li>
            <li><i class="bi bi-chevron-right"></i> <a href="#">About us</a></li>
            <li><i class="bi bi-chevron-right"></i> <a href="#">Services</a></li>
          </ul>
        </div>
        <!--
        <div class="col-lg-2 col-md-3 footer-links">
          <h4>Our Services</h4>
          <ul>
            <li><i class="bi bi-chevron-right"></i> <a href="#">Web Design</a></li>
            <li><i class="bi bi-chevron-right"></i> <a href="#">Web Development</a></li>
            <li><i class="bi bi-chevron-right"></i> <a href="#">Product Management</a></li>
            <li><i class="bi bi-chevron-right"></i> <a href="#">Marketing</a></li>
          </ul>
        </div>-->

        <div class="col-lg-4 col-md-12">
          <h4>Follow Us</h4>
          <p>Follow Us on Our Socials </p>
        </div>

      </div>
    </div>

    <div class="container copyright text-center mt-4">
      <p>© <span>Copyright</span> <strong class="px-1 sitename">Transrect Sales & Servies </strong> <span>All Rights
          Reserved</span></p>
      <div class="credits">
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you've purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: [buy-url] -->
        <!--Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a> -->

      </div>
    </div>

  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <script>
    document.querySelector(".php-email-form").addEventListener("submit", function (event) {
      console.log("Form submitted!");
    });
    document.addEventListener("DOMContentLoaded", () => {
      loadCartItems(); // Load cart items on page load
    });

    // Function to open cart sidebar
    function openCart() {
      loadCartItems();
      document.getElementById("cart-sidebar").style.right = "0";
      document.getElementById("cart-overlay").style.display = "block";
    }

    // Function to close cart sidebar
    function closeCart() {
      document.getElementById("cart-sidebar").style.right = "-350px";
      document.getElementById("cart-overlay").style.display = "none";
    }

    // Function to add a product to the cart
    function addToCart(productId, productName, productImage, productPrice) {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];

      let existingProduct = cart.find(item => item.id === productId);

      if (existingProduct) {
        // Increase quantity if product already exists
        existingProduct.quantity += 1;
      } else {
        // Add new product
        cart.push({ id: productId, name: productName, image: productImage, price: productPrice, quantity: 1 });
      }

      localStorage.setItem("cart", JSON.stringify(cart));
      loadCartItems();
      openCart();
    }

    // Function to load cart items
    function loadCartItems() {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      let cartItemsContainer = document.querySelector(".cart-items");
      let totalAmountContainer = document.querySelector(".total-amount");
      cartItemsContainer.innerHTML = "";

      let totalAmount = 0; // Initialize total amount

      cart.forEach(item => {
        let cartItem = document.createElement("div");
        cartItem.classList.add("cart-item");
        cartItem.dataset.id = item.id;

        let itemTotal = item.price * item.quantity; // Calculate total for each item
        totalAmount += itemTotal; // Add to total amount

        cartItem.innerHTML = `
            <img src="${item.image}" alt="${item.name}">
            <div class="cart-item-info">
                <span>${item.name}</span>
                <strong>${itemTotal} Rs</strong> <!-- Show updated total per item -->
                <div class="quantity-controls">
                    <button class="qty-btn" onclick="updateQuantity('${item.id}', -1)">-</button>
                    <span class="qty">${item.quantity}</span>
                    <button class="qty-btn" onclick="updateQuantity('${item.id}', 1)">+</button>
                </div>
            </div>
            <button class="remove-btn" onclick="removeFromCart('${item.id}')">✖</button>
        `;

        cartItemsContainer.appendChild(cartItem);
      });

      // Update total amount display
      totalAmountContainer.innerHTML = `Total: ${totalAmount} Rs`;
    }


    // Function to update quantity
    function updateQuantity(productId, change) {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      let product = cart.find(item => item.id === productId);

      if (product) {
        product.quantity += change;
        if (product.quantity <= 0) {
          cart = cart.filter(item => item.id !== productId); // Remove item if quantity reaches 0
        }
      }

      localStorage.setItem("cart", JSON.stringify(cart));
      loadCartItems(); // Reload cart and update total amount
    }


    // Function to remove a product from cart
    function removeFromCart(productId) {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      cart = cart.filter(item => item.id !== productId);

      localStorage.setItem("cart", JSON.stringify(cart));
      loadCartItems();
    }

    // Function to handle Buy Now
    function buyNow() {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];

      console.log(cart)
      // Calculate the total amount dynamically
      let totalAmount = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      let quantity = cart.reduce((sum, item) => sum + item.quantity, 0);
      if (totalAmount === 0) {
        alert("Your cart is empty! Please add items before proceeding.");
        return;
      }

      // Extract machine names and quantities
      let machineNames = cart.map(item => encodeURIComponent(item.name)).join(",");
      let machineQuantities = cart.map(item => item.quantity).join(",");

      // alert("Redirecting to Payment Page...");
      alert("Redirecting to Payment Page... ");

      // Redirect to payment page with dynamic totalAmount
      window.location.href = `{{ url_for('log.money_payment', machine_id=desc.id, machine_name=desc.name) }}&machine_price=${totalAmount}&machine_names=${machineNames}&machine_quantities=${machineQuantities}`;

      localStorage.removeItem("cart"); // This removes the entire cart from localStorage
      loadCartItems(); // This will reflect an empty cart after payment
    }



  </script>

  <!-- Vendor JS Files -->
  <script src="{{ url_for('static', filename='assets/vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>
  <script src="{{ url_for('static', filename='assets/vendor/php-email-form/validate.js') }}"></script>
  <script src="{{ url_for('static', filename='assets/vendor/aos/aos.js') }}"></script>
  <script src="{{ url_for('static', filename='assets/vendor/swiper/swiper-bundle.min.js') }}"></script>
  <script src="{{ url_for('static', filename='assets/vendor/glightbox/js/glightbox.min.js') }}"></script>
  <script src="{{ url_for('static', filename='assets/vendor/imagesloaded/imagesloaded.pkgd.min.js') }}"></script>
  <script src="{{ url_for('static', filename='assets/vendor/isotope-layout/isotope.pkgd.min.js') }}"></script>

  <!-- Main JS File -->
  <script src="{{ url_for('static', filename='assets/js/main.js') }}"></script>

  <!-- Cart Sidebar -->
  <div id="cart-sidebar" class="cart-sidebar">
    <div class="cart-header">
      <h3>Shopping Cart</h3>
      <button class="close-btn" onclick="closeCart()">✖</button>
    </div>
    <div class="cart-items">
      <!-- Cart items will be dynamically added here -->
    </div>
    <h4 class="total-amount">Total: 0 Rs</h4>
    <div class="cart-footer">
      <button class="btn btn-success w-100" onclick="buyNow()">Buy Now</button>
    </div>
  </div>

  <!-- Overlay to close cart when clicked outside -->
  <div id="cart-overlay" class="cart-overlay" onclick="closeCart()"></div>


</body>

</html>